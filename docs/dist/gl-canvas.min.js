!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).GLCanvas={})}(this,(function(t){"use strict";
/** @license MIT. Copyright (c) 2020 musakui */class e extends HTMLElement{constructor(t){super(),this._gl=null,this._contextLost=null,this._pixelRatio=window.devicePixelRatio,this._contextAttrs=t||{},this._ctxLost=t=>{t.preventDefault(),this._contextLost=!0,this.contextLostCallback()},this._ctxRestored=()=>{this._contextLost=!1,this.setupCallback(!0)};const e=this.attachShadow({mode:"closed"});this._canvas=this.constructor.populateShadow(e),this._shadowRoot=e}static get booleanContextAttrs(){return{depth:"depth",stencil:"stencil",antialias:"antialias",desynchronized:"desync",preserveDrawingBuffer:"preserve-buffer",failIfMajorPerformanceCaveat:"require-performance"}}static get resizeObserver(){return this._resizeObserver||(this._resizeObserver=new ResizeObserver(t=>{for(const e of t){const t=e.target,s=e.contentRect;t._updateSize(s);const i=new CustomEvent("resize",{detail:s,cancelable:!0});t.dispatchEvent(i)&&t.resizedCallback(s)}})),this._resizeObserver}static get style(){return"\n:host([hidden]) { display: none }\n:host, canvas {\n  width: 100%;\n  height: 100%;\n  display: block;\n}"}static populateShadow(t){const e=document.createElement("canvas");if(this.style instanceof Element)t.appendChild(this.style);else if(this.style){const e=document.createElement("style");e.textContent=this.style,t.appendChild(e)}return t.appendChild(e),e}get gl(){return this._gl}get width(){return this._canvas.width}get height(){return this._canvas.height}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=parseFloat(t)||window.devicePixelRatio}get contextAttributes(){return this._contextAttrs}set contextAttributes(t){try{Object.assign(this._contextAttrs,t||{})}catch(t){}}_parseContextAttrs(){const t=this.hasAttribute("alpha")?this.getAttribute("alpha"):null,e=Object.entries(this.constructor.booleanContextAttrs).map(([t,e])=>[t,this.hasAttribute(e)]);let s=this.getAttribute("power-preference");switch(s){case"high-performance":case"low-power":break;default:s="default"}return{...Object.fromEntries(e),powerPreference:s,alpha:null!==t,premultipliedAlpha:"premultiplied"===t}}_getContext(){if(null!==this._gl)return!0;const t=this.getAttribute("type")||"webgl";0===Object.keys(this._contextAttrs).length&&Object.assign(this._contextAttrs,this._parseContextAttrs());const e=this._canvas.getContext(t,Object.freeze(this._contextAttrs));return null!==e&&(this._gl=e,!0)}_updateSize(t,e){const s=parseFloat(t.width)||this._canvas.clientWidth,i=parseFloat(t.height)||this._canvas.clientHeight,n=Math.floor(s*this.pixelRatio),a=Math.floor(i*this.pixelRatio);(e||this.width!==n||this.height!==a)&&(this._canvas.width=n,this._canvas.height=a)}connectedCallback(){this._getContext()&&(this._updateSize({},!0),this.constructor.resizeObserver.observe(this),this._canvas.addEventListener("webglcontextlost",this._ctxLost),this._canvas.addEventListener("webglcontextrestored",this._ctxRestored),this.hasAttribute("role")||this.setAttribute("role","img"),this.setupCallback(!1))}disconnectedCallback(){this.constructor.resizeObserver.unobserve(this),this._canvas.removeEventListener("webglcontextlost",this._ctxLost),this._canvas.removeEventListener("webglcontextrestored",this._ctxRestored),this.dispatchEvent(new CustomEvent("dispose"))}setupCallback(t){}contextLostCallback(){}resizedCallback(t){this._contextLost||this.gl.viewport(0,0,this.width,this.height)}toBlob(t,e){return new Promise((s,i)=>{try{this._canvas.toBlob(s,t,e)}catch(t){i(t)}})}toDataURL(t,e){return this._canvas.toDataURL(t,e)}}class s extends e{setupCallback(t){if(!this._setup)return;const e=this._setup(this.gl,t);null!==e&&"function"!=typeof e||(this._draw=e)}init(t){"function"==typeof t&&(this._setup=t,null!==this.gl&&this.setupCallback(!1))}draw(...t){return this._contextLost||!this._draw?null:this._draw(...t)}}"customElements"in window&&window.customElements.define("gl-canvas",s),t.GLCanvas=s,Object.defineProperty(t,"__esModule",{value:!0})}));
